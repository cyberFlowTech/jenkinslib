pipeline {
    
    agent {
      label 'macos4'
    }
    
    stages {
        // stage('Pull Codes') {
        //     steps {
        //         git branch: '$Version', credentialsId: '36af8cfe-cad6-456b-88d0-b7ee16c5e425', url: 'git@gitlab.infras.tech:client/android/mimo.git'
        //     }
        // }
        stage('command') {
            steps{
                sh '''
                rm -rf mimo
                
                git clone git@gitlab.infras.tech:client/android/mimo.git
                cp -rf local.properties ./mimo/
                cd mimo
                git checkout $Version
                
                docker run -i --rm --name android_mimo_app -u root -v "/root/jenkins_workspace/bumpVersionCode/mimo:/data" -v "/home/linxin/jenkins/jenkins_mount/keyStore/mimo-lite:/data/keystore" android:gradle7.5 bash -c "chmod 777 /data/gradlew && cd /data/app && ../gradlew bumpVersionCode"
                git add --all
                git commit -m "bump version code by jenkins."
                
                git push origin $Version
                # /bin/expect expect.sh $Version
                '''
            }
        }
    }
}
